# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           qt5 1.0
PortGroup           app 1.0
PortGroup           compilers 1.0

name                wsjt-x
version             2.3.1
categories          science comms
platforms           darwin macosx
license             GPL-2
maintainers         {ra1nb0w @ra1nb0w} openmaintainer
description         Weak Signal Communication
long_description    WSJT-X implements communication protocols or \
    "modes" called FT4, FT8, JT4, JT9, JT65, QRA64, ISCAT, MSK144, and WSPR.
homepage            http://physics.princeton.edu/pulsar/K1JT/wsjtx.html

fetch.type          git
git.url             https://git.code.sf.net/p/wsjt/wsjtx
git.branch          wsjtx-${version}

compiler.c_standard       2011
compiler.cxx_standard     2011
configure.compiler        macports-gcc-11
compiler.require_fortran  yes
compilers.enforce_some_fortran \
    fftw-3 \
    fftw-3-single

patchfiles-append \
    CMakeLists.txt.patch

# not support macOS < 10.10
if { ${os.major} <= 13 } {
    return -code error "unsupported macOS version. ${name} requires macOS >= 10.10"
}

qt5.depends_component \
    qtserialport \
    sqlite-plugin

depends_build-append \
    port:asciidoctor \
    port:asciidoc \
    port:texinfo

depends_lib-append \
    path:lib/libusb.dylib:libusb \
    path:lib/libhamlib.dylib:hamlib \
    port:fftw-3 \
    port:fftw-3-single \
    port:boost

configure.ldflags-append \
    -lboost_filesystem-mt \
    -lboost_system-mt \
    -lboost_log-mt

configure.args-append \
    -DCMAKE_Fortran_COMPILER=${configure.f90}

app.create yes
app.name WSJT-X
app.executable wsjtx
app.icon icons/Darwin/wsjtx.iconset/icon_512x512@2x.png
app.retina yes

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     href=\"wsjtx-(\[0-9.\]+)\.tgz\"
